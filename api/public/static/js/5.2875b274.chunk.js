(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1212:function(e,t,n){"use strict";var a=n(43),r="[COURSES APP] GET COURSES",o="[COURSES APP] SET COURSES SEARCH TEXT";function c(){var e=a.b.get("/courses/get",{params:{mode:"all"}});return function(t){return e.then(function(e){return t({type:r,payload:e.data.doc})})}}function i(e){return{type:o,searchText:e.target.value}}var s=n(13),l=(n(20),n(22)),u=n(76),p="[COURSES APP] GET COURSE",d="[COURSES APP] SAVE COURSE",m="[COURSES APP] OPEN NEW CONTENT DIALOG",f="[COURSES APP] CLOSE NEW CONTENT DIALOG",h="[COURSES APP] OPEN EDIT CONTENT DIALOG",b="[COURSES APP] CLOSE EDIT CONTENT DIALOG",g="[COURSES APP] SAVE CONTENT",v="[COURSES APP] REMOVE CONTENT";function E(e){var t=a.b.get("/courses/contents",{params:e});return function(n){return t.then(function(t){t.data.success||(n(l.j({message:"Get Course Failed"})),u.a.push({pathname:"/manage/courses"})),n({type:p,payload:t.data.data,params:e})})}}function C(e){var t=a.b.post("/courses/contents/save",e);return function(e){return t.then(function(t){return e(l.j({message:"Course Saved"})),e({type:d,payload:t.data,params:{courseId:t.data._id}})})}}function y(e){var t=a.b.post("/courses/setimage",e);return function(n){return t.then(function(t){return n(E({courseId:e.courseId}))})}}function O(){return{type:p,payload:{_id:"",name:"New Course",description:"",slug:"new-course",coverimage:"",contents:[],quizs:[]}}}function S(){return{type:m}}function w(){return{type:f}}function D(e){return{type:h,data:e}}function j(){return{type:b}}function N(e){return function(t,n){var r=n().coursesApp.contents;a.b.post("/courses/contents/add",Object(s.a)({},e,{courseId:r.data._id})).then(function(e){t(l.j({message:"Content Saved"})),Promise.all([t({type:g}),t({type:"new"===r.contentDialog.type?f:b})]).then(function(){return t(E(r.params))})})}}function P(e){return function(t,n){var r=n().coursesApp.contents;a.b.post("/courses/contents/remove",Object(s.a)({},e,{courseId:r.data._id})).then(function(e){t(l.j({message:"Content Removed"})),Promise.all([t({type:v}),t({type:"new"===r.contentDialog.type?f:b})]).then(function(){return t(E(r.params))})})}}n.d(t,"d",function(){return r}),n.d(t,"h",function(){return o}),n.d(t,"l",function(){return c}),n.d(t,"s",function(){return i}),n.d(t,"c",function(){return p}),n.d(t,"g",function(){return d}),n.d(t,"f",function(){return m}),n.d(t,"b",function(){return f}),n.d(t,"e",function(){return h}),n.d(t,"a",function(){return b}),n.d(t,"k",function(){return E}),n.d(t,"r",function(){return C}),n.d(t,"t",function(){return y}),n.d(t,"m",function(){return O}),n.d(t,"o",function(){return S}),n.d(t,"j",function(){return w}),n.d(t,"n",function(){return D}),n.d(t,"i",function(){return j}),n.d(t,"q",function(){return N}),n.d(t,"p",function(){return P})},1216:function(e,t,n){"use strict";var a=n(8),r=n(9),o=n(11),c=n(10),i=n(12),s=n(0),l=n.n(s),u=n(125),p=n(19);t.a=function(e,t){return function(n){return function(s){function d(n){var r;return Object(a.a)(this,d),r=Object(o.a)(this,Object(c.a)(d).call(this,n)),Object(u.b)(e,t),r}return Object(i.a)(d,s),Object(r.a)(d,[{key:"render",value:function(){var t=this;return l.a.createElement(p.a.Consumer,null,function(a){return a.store,a.storeState[e]?l.a.createElement(n,t.props):null})}}]),d}(l.a.PureComponent)}}},1258:function(e,t,n){"use strict";var a=n(15),r=n(13),o=n(1212),c={entities:[],searchText:""},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.d:return Object(r.a)({},e,{entities:t.payload});case o.h:return Object(r.a)({},e,{searchText:t.searchText});default:return e}},s={data:null,params:{},contentDialog:{type:"new",props:{open:!1},data:null}},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.c:case o.g:return Object(r.a)({},e,{data:t.payload,params:t.params});case o.f:return Object(r.a)({},e,{contentDialog:{type:"new",props:{open:!0},data:null}});case o.b:return Object(r.a)({},e,{contentDialog:{type:"new",props:{open:!1},data:null}});case o.e:return Object(r.a)({},e,{contentDialog:{type:"edit",props:{open:!0},data:t.data}});case o.a:return Object(r.a)({},e,{contentDialog:{type:"edit",props:{open:!1},data:null}});default:return e}},u=Object(a.d)({courses:i,contents:l});t.a=u},1464:function(e,t,n){"use strict";n.r(t);var a=n(13),r=n(8),o=n(9),c=n(11),i=n(10),s=n(12),l=n(0),u=n.n(l),p=n(1),d=n(24),m=n(20),f=(n(1301),n(15)),h=n(49),b=n.n(h),g=n(387),v=n(19),E=n(1216),C=n(453),y=n(16),O=n(1212),S=n(1258),w=n(408),D=n.n(w),j=n(452),N=n(43),P={_id:m.s.generateGUID(),name:"",description:"",file:"",pic:""},A=function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return(n=Object(c.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state=Object(a.a)({},P),n.handleFileSelect=function(e){var t=e.target.files[0],a=new FormData;if(t){a.append("file",t);var r={headers:{"content-type":"multipart/form-data"},params:{mode:"section",courseId:n.props.course._id}};return N.b.post("/upload",a,r).then(function(e){n.setState({pic:e.data.file.filename})})}},n.handleChange=function(e){n.setState(y.a.set(Object(a.a)({},n.state),e.target.name,"checkbox"===e.target.type?e.target.checked:e.target.value))},n.closeComposeDialog=function(){"edit"===n.props.contentDialog.type?n.props.closeEditContentDialog():n.props.closeNewContentDialog()},n.uploadFile=function(e){var t=new FormData,a=n.state.file;t.append("file",e),console.log(e);var r={headers:{"content-type":"multipart/form-data"},params:{mode:"video",courseId:n.props.course._id}};return new Promise(function(e,o){N.b.post("/upload",t,r).then(function(t){n.setState({file:t.data.file.filename,prev_file:a}),e()}).catch(function(e){return o})})},n.submitData=Object(j.a)(D.a.mark(function e(){var t;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=document.getElementById("file_url").files[0])){e.next=4;break}return e.next=4,n.uploadFile(t);case 4:n.props.saveContent(n.state);case 5:case"end":return e.stop()}},e)})),n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e,t,n){!e.contentDialog.props.open&&this.props.contentDialog.props.open&&("edit"===this.props.contentDialog.type&&this.props.contentDialog.data&&!y.a.isEqual(this.props.contentDialog.data,t)&&this.setState(Object(a.a)({},this.props.contentDialog.data)),"new"!==this.props.contentDialog.type||y.a.isEqual(P,t)||(P._id=m.s.generateGUID(),this.setState(Object(a.a)({},P))))}},{key:"canBeSubmitted",value:function(){return!0}},{key:"render",value:function(){var e=this,t=this.props,n=t.contentDialog;t.addUser,t.updateUser,t.removeUser;return u.a.createElement(p.l,Object.assign({classes:{paper:"m-24"}},n.props,{onClose:this.closeComposeDialog,fullWidth:!0,maxWidth:"sm"}),u.a.createElement(p.a,{position:"static",elevation:1},u.a.createElement(p.db,{className:"flex w-full"},u.a.createElement(p.fb,{variant:"subtitle1",color:"inherit"},"new"===n.type?"New Content":"Edit Content"))),u.a.createElement(p.n,{classes:{root:"p-24"},style:{textAlign:"center"}},u.a.createElement("img",{src:""===this.state.pic?"assets/images/blank.png":"".concat(N.a,"/uploads/").concat(this.props.course._id,"/").concat(this.state.pic,"?").concat(Date.now()),alt:"",onClick:function(){return document.getElementById("pic_url").click()}}),u.a.createElement("br",null),u.a.createElement("br",null),u.a.createElement("input",{type:"file",id:"pic_url",name:"pic_url",style:{display:"none"},onChange:this.handleFileSelect}),u.a.createElement("div",{className:"flex"},u.a.createElement(p.cb,{className:"mb-24",label:"Section Name",autoFocus:!0,id:"name",name:"name",value:this.state.name,onChange:this.handleChange,variant:"outlined",required:!0,fullWidth:!0})),u.a.createElement("div",{className:"flex"},u.a.createElement(p.cb,{className:"mt-8 mb-16",id:"description",name:"description",label:"Section Description",type:"text",value:this.state.description,onChange:this.handleChange,multiline:!0,rows:5,variant:"outlined",fullWidth:!0})),u.a.createElement("div",{className:"flex",style:{textAlign:"left"}},u.a.createElement(p.fb,{variant:"subtitle1",color:"inherit",className:"min-w-160 pt-20"},"File")),u.a.createElement("input",{type:"file",id:"file_url",name:"file_url"})),"new"===n.type?u.a.createElement(p.m,{className:"justify-between pl-16"},u.a.createElement(p.c,{variant:"contained",color:"primary",onClick:this.submitData,disabled:!this.canBeSubmitted()},"Add")):u.a.createElement(p.m,{className:"justify-between pl-16"},u.a.createElement(p.c,{variant:"contained",color:"primary",onClick:this.submitData,disabled:!this.canBeSubmitted()},"Save"),u.a.createElement(p.C,{onClick:function(){window.confirm("Are you sure to delete it?")&&e.props.removeContent(e.state)}},u.a.createElement(p.B,null,"delete"))))}}]),t}(l.Component);var T=Object(v.b)(function(e){var t=e.coursesApp;return{contentDialog:t.contents.contentDialog,course:t.contents.data}},function(e){return Object(f.c)({closeEditContentDialog:O.i,closeNewContentDialog:O.j,saveContent:O.q,removeContent:O.p},e)})(A),I=function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return(n=Object(c.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).state={tabValue:0,changed:!1,coverimage:"",quizs:[],selected:[]},n.form=u.a.createRef(),n.fetchQuiz=function(){N.b.get("/courses/quizs",{}).then(function(e){n.setState({quizs:e.data.data})})},n.onSubmit=function(e){n.props.saveCourse(Object(a.a)({},n.props.course,{name:e.name,description:e.description,quizs:n.state.selected}))},n.removeCourse=function(){window.confirm("Are you sure to delete this course?")&&N.b.post("/courses/remove",{courseId:n.props.course._id}).then(function(e){e.data.success&&n.props.history.push({pathname:"/manage/courses"})})},n.handleChangeTab=function(e,t){1===t&&""===n.props.course._id||(1===t&&n.state.changed&&n.form.submit(),0===t&&n.setState({changed:!1}),n.setState({tabValue:t}))},n.handleFileSelect=function(e){var t=e.target.files[0],a=new FormData;if(t){a.append("file",t);var r={headers:{"content-type":"multipart/form-data"},params:{mode:"coverimage",courseId:n.props.course._id}};return N.b.post("/upload",a,r).then(function(e){n.props.setCoverImage({file:e.data.file,courseId:n.props.course._id})})}},n.quizChange=function(e){var t=[];e.map(function(e){t.push(e.value)}),n.setState({selected:t})},n}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){"new"===this.props.match.params.courseId?this.props.newCourse():this.props.getCourse(this.props.match.params),this.fetchQuiz()}},{key:"componentWillReceiveProps",value:function(e){this.setState({selected:e.course.quizs})}},{key:"render",value:function(){var e=this,t=this.state.tabValue,n=this.props,a=n.classes,r=n.course;return u.a.createElement(u.a.Fragment,null,u.a.createElement(m.m,{classes:{contentCardWrapper:"sm:p-24 pb-80",leftSidebar:"w-256 border-0",header:"min-h-72 h-72 sm:h-136 sm:min-h-136"},contentToolbar:u.a.createElement(p.bb,{value:t,onChange:this.handleChangeTab,indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto",classes:{root:"w-full h-64"}},u.a.createElement(p.ab,{className:"h-64 normal-case",label:"Basic Info"}),u.a.createElement(p.ab,{className:"h-64 normal-case",label:"Contents"})),content:r&&u.a.createElement("div",{className:"p-16 sm:p-24 max-w-2xl"},0===t&&u.a.createElement("div",{style:{textAlign:"center"}},u.a.createElement("img",{src:""===r.coverimage?"assets/images/img/avatar-bg.jpg":"".concat(N.a,"/uploads/").concat(r._id,"/").concat(r.coverimage,"?").concat(Date.now()),alt:""}),u.a.createElement("input",{type:"file",id:"pic_url",name:"pic_url",style:{display:"none"},onChange:this.handleFileSelect}),u.a.createElement(p.c,{variant:"contained",color:"primary",className:"w-full mx-auto mt-16 mb-16 normal-case","aria-label":"UPLOAD PICTURE",value:"legacy",onClick:function(){return document.getElementById("pic_url").click()},disabled:""===r._id},"UPLOAD PICTURE"),u.a.createElement(b.a,{onValidSubmit:this.onSubmit,ref:function(t){return e.form=t}},u.a.createElement(m.t,{className:"mt-8 mb-16",required:!0,label:"Name",autoFocus:!0,id:"name",name:"name",value:r.name,onChange:function(){return e.setState({changed:!0})},variant:"outlined",fullWidth:!0}),u.a.createElement(m.t,{className:"mt-8 mb-16",id:"description",name:"description",label:"Description",type:"text",value:r.description,onChange:function(){return e.setState({changed:!0})},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}),u.a.createElement(m.d,{className:"",value:this.state.selected.map(function(t){var n=y.a.find(e.state.quizs,{_id:t});return n&&{value:t,label:n.title,class:""}}),onChange:this.quizChange,placeholder:"Select quiz",isMulti:!0,textFieldProps:{variant:"outlined"},options:this.state.quizs.map(function(e){return{value:e._id,label:e.title}})}),u.a.createElement(p.c,{type:"submit",variant:"contained",color:"primary",className:"w-full mx-auto mt-16 normal-case","aria-label":"SAVE",value:"legacy"},"Save"),r._id&&u.a.createElement(p.c,{variant:"contained",color:"primary",className:"w-full mx-auto mt-16 normal-case","aria-label":"REMOVE",value:"legacy",onClick:this.removeCourse},"Remove"))),1===t&&u.a.createElement(m.a,{animation:"transition.slideUpIn",delay:300},u.a.createElement(C.b,{className:"-striped -highlight border-0",getTrProps:function(t,n,a){return{className:"cursor-pointer",onClick:function(t,a){n&&e.props.openEditContentDialog(n.original)}}},data:r.contents,columns:[{Header:"Name",accessor:"name",filterable:!0,className:"font-bold"},{Header:"File",accessor:"file",filterable:!0,className:"font-bold"}],defaultPageSize:10,noDataText:"No contents found"}))),innerScroll:!0}),1===t&&u.a.createElement(m.a,{animation:"transition.expandIn",delay:300},u.a.createElement(p.r,{color:"primary","aria-label":"add",className:a.addButton,onClick:this.props.openNewContentDialog},u.a.createElement(p.B,null,"add"))),u.a.createElement(T,null))}}]),t}(l.Component);t.default=Object(E.a)("coursesApp",S.a)(Object(d.withStyles)(function(e){return{addButton:{position:"absolute",right:12,bottom:12,zIndex:99}}},{withTheme:!0})(Object(g.g)(Object(v.b)(function(e){return{course:e.coursesApp.contents.data}},function(e){return Object(f.c)({newCourse:O.m,getCourse:O.k,saveCourse:O.r,setCoverImage:O.t,openNewContentDialog:O.o,openEditContentDialog:O.n},e)})(I))))}}]);