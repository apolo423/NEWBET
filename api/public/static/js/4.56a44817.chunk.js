(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1278:function(e,t,a){"use strict";var n=a(25),r="[COURSES APP] GET COURSES",o="[COURSES APP] SET COURSES SEARCH TEXT";function i(){var e=n.b.get("/courses/get",{params:{mode:"all"}});return function(t){return e.then(function(e){return t({type:r,payload:e.data.doc})})}}function c(e){return{type:o,searchText:e.target.value}}var s=a(13),l=(a(20),a(37)),u=a(77),p="[COURSES APP] GET COURSE",d="[COURSES APP] SAVE COURSE",m="[COURSES APP] OPEN NEW CONTENT DIALOG",f="[COURSES APP] CLOSE NEW CONTENT DIALOG",h="[COURSES APP] OPEN EDIT CONTENT DIALOG",b="[COURSES APP] CLOSE EDIT CONTENT DIALOG",g="[COURSES APP] SAVE CONTENT",v="[COURSES APP] REMOVE CONTENT";function E(e){var t=n.b.get("/courses/contents",{params:e});return function(a){return t.then(function(t){t.data.success||(a(l.j({message:"Get Course Failed"})),u.a.push({pathname:"/manage/courses"})),a({type:p,payload:t.data.data,params:e})})}}function C(e){var t=n.b.post("/courses/contents/save",e);return function(e){return t.then(function(t){return e(l.j({message:"Course Saved"})),e({type:d,payload:t.data,params:{courseId:t.data._id}})})}}function y(e){var t=n.b.post("/courses/setimage",e);return function(a){return t.then(function(t){return a(E({courseId:e.courseId}))})}}function O(){return{type:p,payload:{_id:"",name:"New Course",description:"",slug:"new-course",coverimage:"",contents:[],quizs:[]}}}function S(){return{type:m}}function w(){return{type:f}}function D(e){return{type:h,data:e}}function N(){return{type:b}}function j(e){return function(t,a){var r=a().coursesApp.contents;n.b.post("/courses/contents/add",Object(s.a)({},e,{courseId:r.data._id})).then(function(e){t(l.j({message:"Content Saved"})),Promise.all([t({type:g}),t({type:"new"===r.contentDialog.type?f:b})]).then(function(){return t(E(r.params))})})}}function A(e){return function(t,a){var r=a().coursesApp.contents;n.b.post("/courses/contents/remove",Object(s.a)({},e,{courseId:r.data._id})).then(function(e){t(l.j({message:"Content Removed"})),Promise.all([t({type:v}),t({type:"new"===r.contentDialog.type?f:b})]).then(function(){return t(E(r.params))})})}}a.d(t,"d",function(){return r}),a.d(t,"h",function(){return o}),a.d(t,"l",function(){return i}),a.d(t,"s",function(){return c}),a.d(t,"c",function(){return p}),a.d(t,"g",function(){return d}),a.d(t,"f",function(){return m}),a.d(t,"b",function(){return f}),a.d(t,"e",function(){return h}),a.d(t,"a",function(){return b}),a.d(t,"k",function(){return E}),a.d(t,"r",function(){return C}),a.d(t,"t",function(){return y}),a.d(t,"m",function(){return O}),a.d(t,"o",function(){return S}),a.d(t,"j",function(){return w}),a.d(t,"n",function(){return D}),a.d(t,"i",function(){return N}),a.d(t,"q",function(){return j}),a.d(t,"p",function(){return A})},1324:function(e,t,a){"use strict";var n=a(15),r=a(13),o=a(1278),i={entities:[],searchText:""},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.d:return Object(r.a)({},e,{entities:t.payload});case o.h:return Object(r.a)({},e,{searchText:t.searchText});default:return e}},s={data:null,params:{},contentDialog:{type:"new",props:{open:!1},data:null}},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.c:case o.g:return Object(r.a)({},e,{data:t.payload,params:t.params});case o.f:return Object(r.a)({},e,{contentDialog:{type:"new",props:{open:!0},data:null}});case o.b:return Object(r.a)({},e,{contentDialog:{type:"new",props:{open:!1},data:null}});case o.e:return Object(r.a)({},e,{contentDialog:{type:"edit",props:{open:!0},data:t.data}});case o.a:return Object(r.a)({},e,{contentDialog:{type:"edit",props:{open:!1},data:null}});default:return e}},u=Object(n.d)({courses:c,contents:l});t.a=u},1522:function(e,t,a){"use strict";a.r(t);var n=a(13),r=a(6),o=a(7),i=a(9),c=a(8),s=a(10),l=a(0),u=a.n(l),p=a(1),d=a(35),m=a(20),f=(a(1366),a(15)),h=a(50),b=a.n(h),g=a(168),v=a(19),E=a(561),C=a(251),y=a(17),O=a(1278),S=a(1324),w=a(79),D=a.n(w),N=a(116),j=a(25),A={_id:m.s.generateGUID(),name:"",description:"",file:"",pic:""},P=function(e){function t(){var e,a;Object(r.a)(this,t);for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return(a=Object(i.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(s)))).state=Object(n.a)({},A),a.handleFileSelect=function(e){var t=e.target.files[0],n=new FormData;if(t){n.append("file",t);var r={headers:{"content-type":"multipart/form-data"},params:{mode:"section",courseId:a.props.course._id}};return j.b.post("/upload",n,r).then(function(e){a.setState({pic:e.data.file.filename})})}},a.handleChange=function(e){a.setState(y.a.set(Object(n.a)({},a.state),e.target.name,"checkbox"===e.target.type?e.target.checked:e.target.value))},a.closeComposeDialog=function(){"edit"===a.props.contentDialog.type?a.props.closeEditContentDialog():a.props.closeNewContentDialog()},a.uploadFile=function(e){var t=new FormData,n=a.state.file;t.append("file",e),console.log(e);var r={headers:{"content-type":"multipart/form-data"},params:{mode:"video",courseId:a.props.course._id}};return new Promise(function(e,o){j.b.post("/upload",t,r).then(function(t){a.setState({file:t.data.file.filename,prev_file:n}),e()}).catch(function(e){return o})})},a.submitData=Object(N.a)(D.a.mark(function e(){var t;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=document.getElementById("file_url").files[0])){e.next=4;break}return e.next=4,a.uploadFile(t);case 4:a.props.saveContent(a.state);case 5:case"end":return e.stop()}},e)})),a}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e,t,a){!e.contentDialog.props.open&&this.props.contentDialog.props.open&&("edit"===this.props.contentDialog.type&&this.props.contentDialog.data&&!y.a.isEqual(this.props.contentDialog.data,t)&&this.setState(Object(n.a)({},this.props.contentDialog.data)),"new"!==this.props.contentDialog.type||y.a.isEqual(A,t)||(A._id=m.s.generateGUID(),this.setState(Object(n.a)({},A))))}},{key:"canBeSubmitted",value:function(){return!0}},{key:"render",value:function(){var e=this,t=this.props,a=t.contentDialog;t.addUser,t.updateUser,t.removeUser;return u.a.createElement(p.l,Object.assign({classes:{paper:"m-24"}},a.props,{onClose:this.closeComposeDialog,fullWidth:!0,maxWidth:"sm"}),u.a.createElement(p.a,{position:"static",elevation:1},u.a.createElement(p.db,{className:"flex w-full"},u.a.createElement(p.fb,{variant:"subtitle1",color:"inherit"},"new"===a.type?"New Content":"Edit Content"))),u.a.createElement(p.n,{classes:{root:"p-24"},style:{textAlign:"center"}},u.a.createElement("img",{src:""===this.state.pic?"assets/images/blank.png":"".concat(j.a,"/uploads/").concat(this.props.course._id,"/").concat(this.state.pic,"?").concat(Date.now()),alt:"",onClick:function(){return document.getElementById("pic_url").click()}}),u.a.createElement("br",null),u.a.createElement("br",null),u.a.createElement("input",{type:"file",id:"pic_url",name:"pic_url",style:{display:"none"},onChange:this.handleFileSelect}),u.a.createElement("div",{className:"flex"},u.a.createElement(p.cb,{className:"mb-24",label:"Section Name",autoFocus:!0,id:"name",name:"name",value:this.state.name,onChange:this.handleChange,variant:"outlined",required:!0,fullWidth:!0})),u.a.createElement("div",{className:"flex"},u.a.createElement(p.cb,{className:"mt-8 mb-16",id:"description",name:"description",label:"Section Description",type:"text",value:this.state.description,onChange:this.handleChange,multiline:!0,rows:5,variant:"outlined",fullWidth:!0})),u.a.createElement("div",{className:"flex",style:{textAlign:"left"}},u.a.createElement(p.fb,{variant:"subtitle1",color:"inherit",className:"min-w-160 pt-20"},"File")),u.a.createElement("input",{type:"file",id:"file_url",name:"file_url"})),"new"===a.type?u.a.createElement(p.m,{className:"justify-between pl-16"},u.a.createElement(p.c,{variant:"contained",color:"primary",onClick:this.submitData,disabled:!this.canBeSubmitted()},"Add")):u.a.createElement(p.m,{className:"justify-between pl-16"},u.a.createElement(p.c,{variant:"contained",color:"primary",onClick:this.submitData,disabled:!this.canBeSubmitted()},"Save"),u.a.createElement(p.C,{onClick:function(){window.confirm("Are you sure to delete it?")&&e.props.removeContent(e.state)}},u.a.createElement(p.B,null,"delete"))))}}]),t}(l.Component);var T=Object(v.b)(function(e){var t=e.coursesApp;return{contentDialog:t.contents.contentDialog,course:t.contents.data}},function(e){return Object(f.c)({closeEditContentDialog:O.i,closeNewContentDialog:O.j,saveContent:O.q,removeContent:O.p},e)})(P),I=function(e){function t(){var e,a;Object(r.a)(this,t);for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return(a=Object(i.a)(this,(e=Object(c.a)(t)).call.apply(e,[this].concat(s)))).state={tabValue:0,changed:!1,coverimage:"",quizs:[],selected:[]},a.form=u.a.createRef(),a.fetchQuiz=function(){j.b.get("/courses/quizs",{}).then(function(e){a.setState({quizs:e.data.data})})},a.onSubmit=function(e){a.props.saveCourse(Object(n.a)({},a.props.course,{name:e.name,description:e.description,quizs:a.state.selected}))},a.removeCourse=function(){window.confirm("Are you sure to delete this course?")&&j.b.post("/courses/remove",{courseId:a.props.course._id}).then(function(e){e.data.success&&a.props.history.push({pathname:"/manage/courses"})})},a.handleChangeTab=function(e,t){1===t&&""===a.props.course._id||(1===t&&a.state.changed&&a.form.submit(),0===t&&a.setState({changed:!1}),a.setState({tabValue:t}))},a.handleFileSelect=function(e){var t=e.target.files[0],n=new FormData;if(t){n.append("file",t);var r={headers:{"content-type":"multipart/form-data"},params:{mode:"coverimage",courseId:a.props.course._id}};return j.b.post("/upload",n,r).then(function(e){a.props.setCoverImage({file:e.data.file,courseId:a.props.course._id})})}},a.quizChange=function(e){var t=[];e.map(function(e){t.push(e.value)}),a.setState({selected:t})},a}return Object(s.a)(t,e),Object(o.a)(t,[{key:"componentWillMount",value:function(){"new"===this.props.match.params.courseId?this.props.newCourse():this.props.getCourse(this.props.match.params),this.fetchQuiz()}},{key:"componentWillReceiveProps",value:function(e){this.setState({selected:e.course.quizs})}},{key:"render",value:function(){var e=this,t=this.state.tabValue,a=this.props,n=a.classes,r=a.course;return u.a.createElement(u.a.Fragment,null,u.a.createElement(m.m,{classes:{contentCardWrapper:"sm:p-24 pb-80",leftSidebar:"w-256 border-0",header:"min-h-72 h-72 sm:h-136 sm:min-h-136"},contentToolbar:u.a.createElement(p.bb,{value:t,onChange:this.handleChangeTab,indicatorColor:"primary",textColor:"primary",variant:"scrollable",scrollButtons:"auto",classes:{root:"w-full h-64"}},u.a.createElement(p.ab,{className:"h-64 normal-case",label:"Basic Info"}),u.a.createElement(p.ab,{className:"h-64 normal-case",label:"Contents"})),content:r&&u.a.createElement("div",{className:"p-16 sm:p-24 max-w-2xl"},0===t&&u.a.createElement("div",{style:{textAlign:"center"}},u.a.createElement("img",{src:""===r.coverimage?"assets/images/img/avatar-bg.jpg":"".concat(j.a,"/uploads/").concat(r._id,"/").concat(r.coverimage,"?").concat(Date.now()),alt:""}),u.a.createElement("input",{type:"file",id:"pic_url",name:"pic_url",style:{display:"none"},onChange:this.handleFileSelect}),u.a.createElement(p.c,{variant:"contained",color:"primary",className:"w-full mx-auto mt-16 mb-16 normal-case","aria-label":"UPLOAD PICTURE",value:"legacy",onClick:function(){return document.getElementById("pic_url").click()},disabled:""===r._id},"UPLOAD PICTURE"),u.a.createElement(b.a,{onValidSubmit:this.onSubmit,ref:function(t){return e.form=t}},u.a.createElement(m.t,{className:"mt-8 mb-16",required:!0,label:"Name",autoFocus:!0,id:"name",name:"name",value:r.name,onChange:function(){return e.setState({changed:!0})},variant:"outlined",fullWidth:!0}),u.a.createElement(m.t,{className:"mt-8 mb-16",id:"description",name:"description",label:"Description",type:"text",value:r.description,onChange:function(){return e.setState({changed:!0})},multiline:!0,rows:5,variant:"outlined",fullWidth:!0}),u.a.createElement(m.d,{className:"",value:this.state.selected.map(function(t){var a=y.a.find(e.state.quizs,{_id:t});return a&&{value:t,label:a.title,class:""}}),onChange:this.quizChange,placeholder:"Select quiz",isMulti:!0,textFieldProps:{variant:"outlined"},options:this.state.quizs.map(function(e){return{value:e._id,label:e.title}})}),u.a.createElement(p.c,{type:"submit",variant:"contained",color:"primary",className:"w-full mx-auto mt-16 normal-case","aria-label":"SAVE",value:"legacy"},"Save"),r._id&&u.a.createElement(p.c,{variant:"contained",color:"primary",className:"w-full mx-auto mt-16 normal-case","aria-label":"REMOVE",value:"legacy",onClick:this.removeCourse},"Remove"))),1===t&&u.a.createElement(m.a,{animation:"transition.slideUpIn",delay:300},u.a.createElement(C.b,{className:"-striped -highlight border-0",getTrProps:function(t,a,n){return{className:"cursor-pointer",onClick:function(t,n){a&&e.props.openEditContentDialog(a.original)}}},data:r.contents,columns:[{Header:"Name",accessor:"name",filterable:!0,className:"font-bold"},{Header:"File",accessor:"file",filterable:!0,className:"font-bold"}],defaultPageSize:10,noDataText:"No contents found"}))),innerScroll:!0}),1===t&&u.a.createElement(m.a,{animation:"transition.expandIn",delay:300},u.a.createElement(p.r,{color:"primary","aria-label":"add",className:n.addButton,onClick:this.props.openNewContentDialog},u.a.createElement(p.B,null,"add"))),u.a.createElement(T,null))}}]),t}(l.Component);t.default=Object(E.a)("coursesApp",S.a)(Object(d.withStyles)(function(e){return{addButton:{position:"absolute",right:12,bottom:12,zIndex:99}}},{withTheme:!0})(Object(g.g)(Object(v.b)(function(e){return{course:e.coursesApp.contents.data}},function(e){return Object(f.c)({newCourse:O.m,getCourse:O.k,saveCourse:O.r,setCoverImage:O.t,openNewContentDialog:O.o,openEditContentDialog:O.n},e)})(I))))}}]);